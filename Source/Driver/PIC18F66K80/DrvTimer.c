/**********************************************************************************************************************/
/**
 * @file        DrvTimerTick.c
 *
 * @author      Stijn Vermeersch
 * @date        02.01.2017
 *
 * @brief       
 *
 *
 * \n<hr>\n
 * Copyright (c) 2021, S-tronics\n
 * All rights reserved.
 * \n<hr>\n
 */
/**********************************************************************************************************************/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; V E R I F Y    C O N F I G U R A T I O N
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; I N C L U D E S
;---------------------------------------------------------------------------------------------------------------------*/
#include "..\..\System\PIC18F66K80\SysLibAll.h"
//DRIVER lib include section
#include "DrvTimer.h"
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   D E F I N I T I O N S   A N D   M A C R O S
;---------------------------------------------------------------------------------------------------------------------*/
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   T Y P E D E F S
;---------------------------------------------------------------------------------------------------------------------*/
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   F U N C T I O N   P R O T O T Y P E S
;---------------------------------------------------------------------------------------------------------------------*/
static void DrvTimerInitPeripheral(unsigned int period);
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; E X P O R T E D   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/
unsigned int drvtmr_tick_count;
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
static void DrvTimerInitPeripheral(unsigned int period)
{
    DOUBLE freq;
    freq = Get_PCLK() / 1000000;
    freq /= 16;                                 //Prescaler 1:16
    freq /= 4;                                  //Fosc/4 is timerclock
    PR4 = (unsigned char)((DOUBLE)(period) * freq) - 1;        //Compare Register Timer4.
    
    T4CON |= 0x02;                              //Prescaler divide by 16
    T4CON |= 0x04;                              //Enable Timer 4
    
}
/**********************************************************************************************************************/



/***********************************************************************************************************************
; E X P O R T E D   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
void DrvTimerInit(unsigned int period)
{
	DrvTimerInitPeripheral(period);                //Every 100µs the timer 
    drvtmr_tick_count = 0;
}
/*--------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

