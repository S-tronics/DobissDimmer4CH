/**********************************************************************************************************************/
/**
 * @file        DrvTimerTick.c
 *
 * @author      Stijn Vermeersch
 * @date        02.01.2017
 *
 * @brief       
 *
 *
 * \n<hr>\n
 * Copyright (c) 2017, S-tronics\n
 * All rights reserved.
 * \n<hr>\n
 */
/**********************************************************************************************************************/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; V E R I F Y    C O N F I G U R A T I O N
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; I N C L U D E S
;---------------------------------------------------------------------------------------------------------------------*/
#include "..\..\System\PIC18F66K80\SysLibAll.h"
//DRIVER lib include section
#include "DrvTimerTick.h"
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   D E F I N I T I O N S   A N D   M A C R O S
;---------------------------------------------------------------------------------------------------------------------*/
//#define INT_TMR2IE  0x02        //Timer 2 Interrupt Enable
//#define INT_TMR2IP  0x02        //Timer 2 interrupt priority
//#define INT_TMR2IF  0x02        //Timer 2 Interrupt Flag
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   T Y P E D E F S
;---------------------------------------------------------------------------------------------------------------------*/
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   F U N C T I O N   P R O T O T Y P E S
;---------------------------------------------------------------------------------------------------------------------*/
static void DrvTimerInitPeripheral(unsigned int period);
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; E X P O R T E D   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/
unsigned int     drvtmrtick_tick_count;
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
static void DrvTimerInitPeripheral(unsigned int period)
{
    double freq;
    freq = Get_PCLK() / 1000000;
    freq /= 16;
    freq /= 4;
    PR2 = (unsigned char)((double)(period) * freq) - 1;       //Compare Register Timer2
    
    T2CON |= 0x02;          //Prescaler divide by 16
    //T2CON |= 0x18;          //Postscaler divide by 4
    T2CON |= 0x04;          //Enable Timer 2
    
}
/**********************************************************************************************************************/



/***********************************************************************************************************************
; E X P O R T E D   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
void DrvTimerTickInit(unsigned int period)
{
	DrvTimerInitPeripheral(period);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvTimerTickEnableInterrupt(void)
{
    //PIE1bits.TMR2IE = 1;
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvTimerTickDisableInterrupt(void)
{
    //PIE1bits.TMR2IE = 0;
}
/**********************************************************************************************************************/

